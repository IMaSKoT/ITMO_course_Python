markdown
# Отчет по лабораторной работе №8
## Клиент-серверное приложение на Python (MVC, Jinja2, HTTPServer)

**Выполнил:** Седов Максим, группа P3124

---

### 1) Цель работы

- Создать простое клиент-серверное приложение на Python без серверных фреймворков
- Освоить работу с HTTPServer и маршрутизацию запросов
- Применять шаблонизатор Jinja2 для отображения данных
- Реализовать модели предметной области с геттерами и сеттерами
- Структурировать код в соответствии с архитектурой MVC
- Получать данные о курсах валют через API Центробанка
- Реализовать подписки пользователей на валюты и отображение динамики
- Научиться создавать тесты для моделей и серверной логики

---

### 2) Описание предметной области

В лабораторной работе реализованы следующие модели:

1. user(id, name) - модель пользователя

2. currency(id, code, name, value, nominal) - модель валюты

3. usercurrency(id, user_id, currency_id) - модель связи пользователя и валют, на которые он подписан

4. author(name, group) - модель автора приложения

5. app(name, version, author) - модель информации о приложении

---

### 3) Структура проекта
myapp/  
├── models/ # Модели данных  
│ ├── init.py  
│ ├── app.py  
│ ├── author.py  
│ ├── currency.py  
│ ├── user.py  
│ └── usercurrency.py  
├── templates/ # HTML-шаблоны  
│ ├── index.html  
│ ├── currencies.html  
│ ├── users.html  
│ ├── user.html  
│ └── AboutApp.html  
├── utils/ # Вспомогательные модули  
│ ├── init.py  
│ └── currencies_api.py  
├── myapp.py # Сервер и маршрутизация  
└── lab8Test.py # Тесты  

---

### 4) Описание реализации

#### 1. Модели данных

Все модели реализованы с валидацией данных через геттеры и сеттеры

Вот пример:

```python
@property
def name(self):
    return self.__name

@name.setter
def name(self, name: str):
    if type(name) is str and len(name) >= 2:
        self.__name = name
    else:
        raise ValueError('Ошибка при задании имени пользователя')
```
#### 2. Контроллер и маршрутизация  
Основной класс обработки запросов:

```python
class SimpleHTTPRequestHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        url = urlparse(self.path)
        path = url.path
        
        if path == '/':
            # Главная страница
        elif path == '/currencies':
            # Страница валют
        elif path == '/users':
            # Список пользователей
        elif path == '/user':
            # Профиль пользователя
        elif path == '/aboutapp':
            # О приложении
```
#### 3. Шаблонизатор Jinja2
Инициализация окружения для работы с шаблонами:

```python
env = Environment(
    loader=PackageLoader("myapp"),
    autoescape=select_autoescape()
)
```
#### 4. Работа с API валют
Интеграция с API Центробанка России:
```python
# Получение данных за последний день
currency_data = get_currencies(['USD', 'EUR', 'GBP'])

# Получение данных за последние days дней
hist_data = get_currencies_with_days(['USD', 'EUR', 'GBP'], days=90)
```
Сама реализация расположена в currencies_api.py


---


### 5) Примеры работы приложения

#### 1. Главная страница (/)
На главной странице представлена навигация по всем разделам приложения. Пользователь может перейти к просмотру курсов валют, списку пользователей или информации о приложении.
![main_page.png](screenshots%2Fmain_page.png)
#### 2. Страница валют (/currencies)
Страница отображает таблицу с актуальными курсами валют. Для каждой валюты выводится:
- Буквенный код (USD, EUR, GBP)
- Цифровой код
- Название валюты
- Текущий курс к рублю
- Номинал  

![currencies_list.png](screenshots%2Fcurrencies_list.png)

#### 3. Список пользователей (/users)
Страница содержит список всех зарегистрированных пользователей системы. Каждый пользователь представлен в виде ссылки, ведущей на его персональную страницу.
![users_list.png](screenshots%2Fusers_list.png)
#### 4. Профиль пользователя (/user?id=...)
На странице профиля отображается:
- Информация о пользователе (имя, ID)
- Список валют, на которые подписан пользователь
- Графики изменения курсов за последние 90 дней

![user_profile.png](screenshots%2Fuser_profile.png)
#### 5. О приложении  (/aboutapp)
Страница содержит информацию о версии приложения, его названии и его авторе
![aboutapp.png](screenshots%2Faboutapp.png)

---

### 6) Самостоятельная работа

#### 1. Визуализация исторических данных
Реализована функциональность отображения графиков изменения курсов валют за последние 3 месяца (90 дней). Для визуализации используется библиотека Chart.js.

Пример реализации графика:
![chart.png](screenshots%2Fchart.png)

#### 2. Используемые технологии
Chart.js - JavaScript-библиотека для создания интерактивных графиков

Исторические данные получаются через функцию get_currencies_with_days(), которая делает запросы к архивным данным Центробанка(количество запросов зависит от поданного параметра days). Данные кэшируются и передаются в шаблоны для отображения.Сама реализация находится в currencies_api.py

---

### 7) Тестирование
#### 1. Пример тестирования моделей
```python
#Проверка создания пользователя
def test1(self):
    user = Users("Ivan", "101")
    self.assertEqual(user.name, "Ivan")
    self.assertEqual(user.id, "101")

#Проверка на неккоректное имя пользователя
def test2(self):
    with self.assertRaises(ValueError):
        Users("I", "123")

```
#### 2. Тестирование API функций
```python
#Тест на работу функции get_currencies
def test8(self):
    data = get_currencies(['USD'])
    self.assertIsInstance(data, dict)
    usd_info = data['USD']
    self.assertIsInstance(usd_info, tuple)
    self.assertEqual(len(usd_info), 5)
def test9(self):
    with self.assertRaises(requests.exceptions.RequestException):
        get_currencies(['USD'], url="https//wfgewfgew9uw9f0")
```
#### 3. Результаты тестов
Все тесты были успешно пройдены:
![tests.png](screenshots%2Ftests.png)

---

### 8)Выводы
#### 1. Проблемы при реализации
- Реализация различных маршрутов   
Первоначально были проблемы с реализацией страниц, чтобы они корректно отображались в приложении. Необходимо было обрабатывать различные пути и извлекать query-параметры.  
Было решено использовать urllib.parse.urlparse и urllib.parse.parse_qs для разбора URL и параметров. Затем использовать условные операторы в методе do_GET для выбора соответствующего обработчика.
- Обработка данных API за несколько дней  
Архивные данные Центробанка доступны не для всех дат. Реализована логика подстановки последних доступных значений.

- Передача данных в шаблоны  
Сложности с передачей объектов Python в JavaScript. Решено использованием Jinja2.

#### 2.  Применение принципов MVC
Models - модели сущностей, применяемых в моем приложении(папка models)

Views - HTML-шаблоны с логикой отображения(папка templates)

Controller - SimpleHTTPRequestHandler обрабатывает запросы и управляет потоком данных(myapp.py)

Архитектура позволила четко разделить ответственность и упростить поддержку кода.

#### 3. Полученные знания
- HTTPServer  
Я освоил работу с базовым HTTP-сервером Python, маршрутизацией запросов и обработкой query-параметров.

- Jinja2  
Я изучил приниципы шаблонизации данных, а также научился базово использовать Jinja2 для создания приложений с MVC архитектурой

- API Центробанка  
Я получил опыт работы с внешними API, обработкой JSON-данных и кэшированием результатов.

- HTML  
Я получил базовые навыки работы с созданием страниц с помощью HTML

- MVC  
Я поулчил навыки структурирования приложения согласно архитектуре MVC без использования фреймворков.

